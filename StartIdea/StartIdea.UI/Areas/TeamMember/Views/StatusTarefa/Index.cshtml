@model StartIdea.UI.Areas.TeamMember.ViewModels.StatusTarefaVM

@section CustomScript{
    <script type="text/javascript">
        $(function () {
            $(".droptrue").sortable({
                receive: function (event, ui) {
                    var idStatus = ui.item[0].parentNode.attributes['data-id'].value;
                    var idTarefa = ui.item[0].attributes['data-id'].value;
                    console.log(idTarefa);
                    $.ajax({
                        url: "@Html.Raw(Url.Action("AlteraStatus"))",
                        type: 'POST',
                        contentType: "application/json",
                        data: JSON.stringify({ 'IdStatus': idStatus, 'IdTarefa': idTarefa }),
                        success: function (result) {
                            console.log(result);
                            if (!result.sucesso) {
                                $(".droptrue").sortable("cancel");
                            }
                        }
                    });
                }
            });
        });
    </script>
}

<div class="row">
    @foreach (var status in Model.StatusProcesso)
    {
        <div class="col-md-3 col-sm-4 col-xs-12">
            <div class="panel panel-primary">
                <div class="panel-heading text-center">@status.Descricao</div>
                <div class="panel-body panel-body-status-tarefa">
                    <ul data-id="@status.Id" class="droptrue list-unstyled ul-tarefas">
                        @foreach (var tarefa in Model.TarefasProcesso)
                        {
                            if (status.Id == tarefa.StatusTarefas.OrderByDescending(st => st.DataInclusao).First().Status.Id)
                            {
                                <li class="ui-state-default well well-sm well-tarefa" data-id="@tarefa.Id">@tarefa.Descricao</li>
                            }
                        }
                    </ul>
                </div>
            </div>
        </div>
    }
</div>
<br style="clear:both">